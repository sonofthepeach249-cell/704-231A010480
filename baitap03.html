<!doctype html>
<html lang="vi">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>B√†i 3 - Game ƒêo√°n S·ªë</title>
    <link rel="stylesheet" href="css/style.css" />
    <style>
      .container {
        max-width: 600px;
        margin: 0 auto;
        padding: 20px;
        text-align: center;
      }
      .game-area {
        background: white;
        padding: 30px;
        border-radius: 10px;
        box-shadow: 0 4px 20px rgba(0, 0, 0, 0.1);
        margin: 20px 0;
      }
      .input-section {
        margin: 20px 0;
      }
      .input-section input {
        padding: 10px;
        width: 100px;
        text-align: center;
        font-size: 20px;
        border: 2px solid #667eea;
        border-radius: 5px;
        margin: 0 10px;
      }
      .message {
        margin: 20px 0;
        padding: 15px;
        border-radius: 5px;
        font-weight: bold;
      }
      .message.high {
        background: #fed7d7;
        color: #9b2c2c;
      }
      .message.low {
        background: #c6f6d5;
        color: #22543d;
      }
      .message.correct {
        background: #e6fffa;
        color: #234e52;
      }
      .history {
        margin-top: 20px;
      }
      .history-item {
        display: inline-block;
        margin: 5px;
        padding: 8px 12px;
        background: #edf2f7;
        border-radius: 5px;
      }
      .fireworks {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        pointer-events: none;
        z-index: 100;
        display: none;
      }
      .firework {
        position: absolute;
        width: 5px;
        height: 5px;
        border-radius: 50%;
      }
      .explanation {
        background: white;
        padding: 20px;
        margin-top: 30px;
        border-radius: 10px;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        text-align: left;
      }
      .explanation h3 {
        color: #667eea;
        margin-bottom: 10px;
      }
      .explanation ul {
        padding-left: 20px;
        margin: 10px 0;
      }
      .explanation li {
        margin-bottom: 5px;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <a href="index.html" class="btn back-btn">‚Üê Tr·ªü v·ªÅ trang ch·ªß</a>
      <h1>B√†i 3: Game ƒêo√°n S·ªë</h1>

      <div class="game-area">
        <h2>ƒêo√°n s·ªë t·ª´ 1 ƒë·∫øn 100</h2>
        <p>Nh·∫≠p s·ªë c·ªßa b·∫°n v√† nh·∫•n "ƒêo√°n" ho·∫∑c Enter</p>

        <div class="input-section">
          <input
            type="number"
            id="guessInput"
            min="1"
            max="100"
            placeholder="S·ªë"
          />
          <button class="btn" id="guessBtn">ƒêo√°n</button>
          <button class="btn" id="newGameBtn">Game m·ªõi</button>
        </div>

        <div id="message" class="message"></div>

        <div>
          <p>S·ªë l·∫ßn ƒëo√°n: <span id="attempts">0</span></p>
          <p>S·ªë c·∫ßn ƒëo√°n: <span id="secretNumber">?</span></p>
        </div>

        <div class="history" id="history"></div>
      </div>

      <div class="explanation">
        <h3>Logic x·ª≠ l√Ω:</h3>
        <ul>
          <li>
            <strong>Random number:</strong> Math.floor(Math.random() * 100) + 1
            ƒë·ªÉ t·∫°o s·ªë ng·∫´u nhi√™n 1-100
          </li>
          <li>
            <strong>Validation:</strong> Ki·ªÉm tra input c√≥ ph·∫£i s·ªë h·ª£p l·ªá 1-100,
            kh√¥ng tr√πng v·ªõi l·∫ßn ƒëo√°n tr∆∞·ªõc
          </li>
          <li>
            <strong>State management:</strong> L∆∞u secretNumber, attempts,
            guessHistory trong bi·∫øn
          </li>
          <li>
            <strong>Fireworks effect:</strong> T·∫°o 50 particles v·ªõi random
            position, color, animation b·∫±ng CSS
          </li>
          <li>
            <strong>Error handling:</strong> Try-catch cho LocalStorage,
            validate input tr∆∞·ªõc khi x·ª≠ l√Ω
          </li>
        </ul>
      </div>

      <div class="fireworks" id="fireworks"></div>
    </div>

    <script>
      let secretNumber, attempts, guessHistory;

      function initGame() {
        secretNumber = Math.floor(Math.random() * 100) + 1;
        attempts = 0;
        guessHistory = [];
        updateDisplay();
        document.getElementById("message").textContent = "H√£y b·∫Øt ƒë·∫ßu ƒëo√°n s·ªë!";
        document.getElementById("message").className = "message";
        document.getElementById("secretNumber").textContent = "?";
        hideFireworks();
      }

      function checkGuess() {
        const input = document.getElementById("guessInput");
        const guess = parseInt(input.value);

        if (isNaN(guess) || guess < 1 || guess > 100) {
          alert("Vui l√≤ng nh·∫≠p s·ªë t·ª´ 1 ƒë·∫øn 100");
          return;
        }

        if (guessHistory.includes(guess)) {
          alert("B·∫°n ƒë√£ ƒëo√°n s·ªë n√†y r·ªìi!");
          return;
        }

        attempts++;
        guessHistory.push(guess);

        let message = "",
          className = "";

        if (guess === secretNumber) {
          message = `üéâ Ch√≠nh x√°c! B·∫°n ƒëo√°n ƒë√∫ng sau ${attempts} l·∫ßn!`;
          className = "correct";
          document.getElementById("secretNumber").textContent = secretNumber;
          showFireworks();
          saveHighScore();
        } else if (guess < secretNumber) {
          message = `üìâ Qu√° th·∫•p! S·ªë ${guess} nh·ªè h∆°n s·ªë b√≠ m·∫≠t`;
          className = "low";
        } else {
          message = `üìà Qu√° cao! S·ªë ${guess} l·ªõn h∆°n s·ªë b√≠ m·∫≠t`;
          className = "high";
        }

        document.getElementById("message").textContent = message;
        document.getElementById("message").className = `message ${className}`;
        updateDisplay();
        input.value = "";
        input.focus();
      }

      function updateDisplay() {
        document.getElementById("attempts").textContent = attempts;

        const historyDiv = document.getElementById("history");
        historyDiv.innerHTML = guessHistory
          .map((guess) => `<span class="history-item">${guess}</span>`)
          .join(" ");
      }

      function showFireworks() {
        const fireworks = document.getElementById("fireworks");
        fireworks.style.display = "block";
        fireworks.innerHTML = "";

        for (let i = 0; i < 50; i++) {
          const firework = document.createElement("div");
          firework.className = "firework";
          firework.style.left = `${Math.random() * 100}%`;
          firework.style.top = `${Math.random() * 100}%`;
          firework.style.background = `hsl(${Math.random() * 360}, 100%, 50%)`;
          firework.style.animation = `fireworkAnim ${1 + Math.random()}s ease-out forwards`;
          fireworks.appendChild(firework);
        }

        setTimeout(hideFireworks, 3000);
      }

      function hideFireworks() {
        document.getElementById("fireworks").style.display = "none";
      }

      function saveHighScore() {
        try {
          const highScores =
            JSON.parse(localStorage.getItem("highScores")) || [];
          highScores.push({ attempts, date: new Date().toLocaleDateString() });
          highScores.sort((a, b) => a.attempts - b.attempts);
          localStorage.setItem(
            "highScores",
            JSON.stringify(highScores.slice(0, 10)),
          );
        } catch (e) {
          console.log("Kh√¥ng th·ªÉ l∆∞u high score:", e);
        }
      }

      document.getElementById("guessBtn").addEventListener("click", checkGuess);
      document.getElementById("newGameBtn").addEventListener("click", initGame);
      document
        .getElementById("guessInput")
        .addEventListener("keypress", (e) => {
          if (e.key === "Enter") checkGuess();
        });

      initGame();

      // Th√™m CSS animation cho ph√°o hoa
      const style = document.createElement("style");
      style.textContent = `
            @keyframes fireworkAnim {
                0% { transform: scale(1); opacity: 1; }
                100% { transform: scale(3); opacity: 0; }
            }
        `;
      document.head.appendChild(style);
    </script>
  </body>
</html>
